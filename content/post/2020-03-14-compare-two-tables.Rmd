---
title: Compare two tables with compare()
author: zchmielewska
date: '2020-03-14'
slug: compare-two-tables
categories: []
tags: []
description: ''
---

# Usage

A big chunk of actuarial life consists of comparing things.

After preparing assumptions tables and policy data for valuation models,
it's useful to check how they change over a reporting period 
to understand the magnitude of movements and for overall sense-check.

During the model development, it's important to understand the impact
of each of the components on the final results.

The `compare()` function helps to see the differences of two tables.


```{r echo = FALSE, message = FALSE}
# it's not yet in CRAN
devtools::install_github("zchmielewska/actuaryr")
```

```{r}
library(actuaryr)
```

```{r}
x <- data.frame(
  v1 = c(1, 2, 3),
  v2 = c("a", "b", "c"),
  v4 = c(10, 10, 10),
  stringsAsFactors = FALSE
)
print(x)
```

```{r}
y <- data.frame(
  v1 = c(1, 2, 4, 5),
  v2 = c("a", "b", "d", "e"),
  v3 = c(6, 7, 8, 9),
  v4 = c("10", "10", "10", "10"),
  stringsAsFactors = FALSE
)
print(y)
```

```{r}
compare(x, y)
```

The result of the comparison is:

* for numericals - the absolute difference between `x` and `y`,
* for characters - the value either `the_same` or `different`.

The function prints few diagnostic messages. 
These diagnostic messages result from the approach taken for the comparison. 
The approach is described in the next section.

# Methodology

The `compare()` function uses the following approach:

1. Only common columns are compared. 

2. Only common rows are compared. 

3. If the same columns have different types between the two tables, 
the weaker type gets coerced to the stronger type. 
The order of strength: logical < integer < double < character.

4. The comparison depends on the type: 
for numericals the absolute difference is returned, 
for characters either `the_same` or `different` is returned.

Let's see some examples of this behaviour.

## Example 1 - only common columns

Only common columns of the two data frames are compared. 
The rest of the columns are ignored for the comparison.

```{r echo = FALSE}
x <- data.frame(
  v1 = c(1, 2, 3),
  v2 = c("a", "b", "c"),
  stringsAsFactors = FALSE
)

y <- data.frame(
  v1 = c(1, 2, 2),
  v3 = c("d", "e", "f"),
  stringsAsFactors = FALSE
)
```

LHS:

```{r}
print(x)
```

RHS:

```{r}
print(y)
```

Result:

```{r}
compare(x, y)
```

Only `v1` is a common column between the two tables, 
so the rest of the columns have been ignored.

## Example 2
Only common rows of the two data frames are compared. 
If one data frame has more rows, the extra rows are removed 
from the comparison.


```{r echo = FALSE}
x <- data.frame(
  v1 = c(1, 2, 3),
  v2 = c("a", "b", "c"),
  v3 = c(4, 5, 6),
  stringsAsFactors = FALSE
)

y <- data.frame(
  v1 = c(1, 2, 2),
  v2 = c("a", "c", "c"),
  stringsAsFactors = FALSE
)
```

LHS:

```{r}
print(x)
```

RHS:

```{r}
print(y)
```

Result:

```{r}
compare(x, y)
```

The diagnostic message informs that there is no column `v3` in the second table, 
so this column has been removed from the comparison. Only columns `v1` and `v2` 
are compared.

## Example 3

```{r echo = FALSE}
x <- data.frame(
  v1 = c(1, 2, 3),
  v2 = c("a", "b", "c"),
  stringsAsFactors = FALSE
)

y <- data.frame(
  v1 = c(1, 2),
  v2 = c("a", "c"),
  stringsAsFactors = FALSE
)
```

LHS:

```{r}
print(x)
```

RHS:

```{r}
print(y)
```

Result:

```{r}
compare(x, y)
```

The diagnostic messages concern the issue that 
there are 2 rows in the second table and 3 rows in the first table.
The 3rd row in the first table has been removed for the comparison.
Only the first 2 rows of both tables are compared.

## Example 4

```{r echo = FALSE}
x <- data.frame(
  v1 = c(1, 2),
  stringsAsFactors = FALSE
)

y <- data.frame(
  v1 = c("1", "2"),
  stringsAsFactors = FALSE
)
```

LHS:

```{r}
str(x)
```

RHS:

```{r}
str(y)
```

Result:

```{r}
compare(x, y)
```

Columns with weaker types are coerced to columns with stronger types.

In this example, the `v1` column in the first table is a double and
in the second table it's a character.
For comparison, the `v1` column in the first table is coerced to a character.
